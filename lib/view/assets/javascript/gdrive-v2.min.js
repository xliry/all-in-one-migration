jQuery(document).ready(function($){'use strict';$(document).on('click','#ai1wm-import-gdrive-v2',function(e){e.preventDefault();$('.ai1wm-gdrive-v2-import-dialog').fadeIn(300);$('#ai1wm-gdrive-v2-url').val('');$('#ai1wm-gdrive-v2-messages').hide().html('');});$(document).on('click','#ai1wm-gdrive-v2-cancel, .ai1wm-gdrive-v2-import-dialog .ai1wm-overlay',function(e){e.preventDefault();$('.ai1wm-gdrive-v2-import-dialog').fadeOut(300);});$(document).on('click','#ai1wm-gdrive-v2-submit',function(e){e.preventDefault();var button=$(this);var url=$('#ai1wm-gdrive-v2-url').val().trim();var messageContainer=$('#ai1wm-gdrive-v2-messages');messageContainer.hide().html('');if(!url){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>Please enter a Google Drive URL.</p>'+'</div>').show();return;}if(url.indexOf('drive.google.com')===-1){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>Please enter a valid Google Drive URL.</p>'+'</div>').show();return;}button.prop('disabled',true);messageContainer.html('<div class="ai1wm-message ai1wm-info-message">'+'<p>Starting Google Drive import (V2 - No API Key)...</p>'+'</div>').show();var secretKey=ai1wm_import.secret_key||'';$.ajax({type:'POST',url:ajaxurl,data:{action:'ai1wm_gdrive_v2_import',gdrive_v2_url:url,secret_key:secretKey},dataType:'json',success:function(response){$('.ai1wm-gdrive-v2-import-dialog').fadeOut(300);if(response&&!response.errors){if(typeof ai1wm_import!=='undefined'&&typeof ai1wm_import.poll_status==='function'){ai1wm_import.poll_status();}}else if(response.errors&&response.errors.length>0){var errorMessage=response.errors[0].message||'Unknown error occurred';messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>'+errorMessage+'</p>'+'</div>').show();$('.ai1wm-gdrive-v2-import-dialog').fadeIn(300);}},error:function(xhr,status,error){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>Import failed: '+error+'</p>'+'</div>').show();},complete:function(){button.prop('disabled',false);}});});});
