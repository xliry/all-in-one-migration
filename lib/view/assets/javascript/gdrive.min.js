jQuery(document).ready(function($){'use strict';$(document).on('click','#ai1wm-import-gdrive',function(e){e.preventDefault();$('.ai1wm-gdrive-import-dialog').fadeIn(300);$('#ai1wm-gdrive-url').val('');$('#ai1wm-gdrive-messages').hide().html('');});$(document).on('click','#ai1wm-gdrive-cancel, .ai1wm-overlay',function(e){e.preventDefault();$('.ai1wm-gdrive-import-dialog').fadeOut(300);});$(document).on('click','#ai1wm-gdrive-submit',function(e){e.preventDefault();var button=$(this);var url=$('#ai1wm-gdrive-url').val().trim();var messageContainer=$('#ai1wm-gdrive-messages');messageContainer.hide().html('');if(!url){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>Please enter a Google Drive URL.</p>'+'</div>').show();return;}if(url.indexOf('drive.google.com')===-1){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>Please enter a valid Google Drive URL.</p>'+'</div>').show();return;}button.prop('disabled',true);messageContainer.html('<div class="ai1wm-message ai1wm-info-message">'+'<p>Checking API key configuration...</p>'+'</div>').show();$.ajax({type:'POST',url:ajaxurl,data:{action:'ai1wm_check_gdrive_key'},dataType:'json',success:function(response){if(!response.success){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>'+response.data.message+' '+'Please configure your API key in <a href="'+ai1wm_locale.settings_url+'">Settings</a>.</p>'+'</div>').show();button.prop('disabled',false);return;}startGdriveImport(url,button,messageContainer);},error:function(xhr,status,error){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>Error checking API key: '+error+'</p>'+'</div>').show();button.prop('disabled',false);}});});function startGdriveImport(url,button,messageContainer){messageContainer.html('<div class="ai1wm-message ai1wm-info-message">'+'<p>Starting Google Drive import...</p>'+'</div>').show();var secretKey=ai1wm_import.secret_key||'';$.ajax({type:'POST',url:ajaxurl,data:{action:'ai1wm_gdrive_import',gdrive_url:url,secret_key:secretKey},dataType:'json',success:function(response){$('.ai1wm-gdrive-import-dialog').fadeOut(300);if(response&&!response.errors){if(typeof ai1wm_import!=='undefined'&&typeof ai1wm_import.poll_status==='function'){ai1wm_import.poll_status();}}else if(response.errors&&response.errors.length>0){var errorMessage=response.errors[0].message||'Unknown error occurred';messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>'+errorMessage+'</p>'+'</div>').show();$('.ai1wm-gdrive-import-dialog').fadeIn(300);}},error:function(xhr,status,error){messageContainer.html('<div class="ai1wm-message ai1wm-error-message">'+'<p>Import failed: '+error+'</p>'+'</div>').show();},complete:function(){button.prop('disabled',false);}});}});
